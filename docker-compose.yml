version: '3'

networks:
  backend:
    driver: ${NETWORKS_DRIVER}


services:

  rmq0: &rabbitmq
    # https://hub.docker.com/r/pivotalrabbitmq/rabbitmq-prometheus/tag


    image: pivotalrabbitmq/rabbitmq-prometheus:3.9.0-alpha.76-2019.10.30
    networks:
      - backend
    ports:
      - "5672:5672"
      - "15672:15672"
      - "15692:15692"

  ### PHP-FPM,NGINX,supervisor Server #########################################
  nginx:
    build:
      context: ./nginxphp
    volumes:
      - /kalading/webroot:/kalading/webroot
      - /kalading/webroot/nginx:/etc/nginx/conf.d/
      - /kalading/webroot/supervisor:/etc/supervisord.d/
    ports:
      - "80:80"
      - "81:81"
      #- "443:443"
    extra_hosts:
      - "dockerhost:${DOCKER_HOST_IP}"
      - dev.api.backend.kalading.com:127.0.0.1
      - dev.api.car.kalading.com:127.0.0.1
      - dev.api.crm.kalading.com:127.0.0.1
      - dev.api.jd.kalading.com:127.0.0.1
      - dev.api.notice.kalading.com:127.0.0.1
      - dev.api.notify.kalading.com:127.0.0.1
      - dev.api.scm.kalading.com:127.0.0.1
      - dev.api.user.kalading.com:127.0.0.1
      - dev.backend.kalading.com:127.0.0.1
      - dev.m.kalading.com:127.0.0.1
      - dev1.api.jd.kalading.com:127.0.0.1
      - dev1.jd.kalading.com:127.0.0.1
      - dev.jd.kalading.com:127.0.0.1
      - dev.scm.kalading.com:127.0.0.1
      - lbf.api.backend.kalading.com:127.0.0.1
      - lbf.api.car.kalading.com:127.0.0.1
      - lbf.api.crm.kalading.com:127.0.0.1
      - lbf.api.jd.kalading.com:127.0.0.1
      - lbf.api.notice.kalading.com:127.0.0.1
      - lbf.api.notify.kalading.com:127.0.0.1
      - lbf.api.scm.kalading.com:127.0.0.1
      - lbf.api.user.kalading.com:127.0.0.1
      - lbf.backend.kalading.com:127.0.0.1
      - lbf.m.kalading.com:127.0.0.1
      - lbf1.api.jd.kalading.com:127.0.0.1
      - lbf1.jd.kalading.com:127.0.0.1
      - lbf.jd.kalading.com:127.0.0.1
      - lbf.scm.kalading.com:127.0.0.1
      - wjl.api.backend.kalading.com:127.0.0.1
      - wjl.api.car.kalading.com:127.0.0.1
      - wjl.api.crm.kalading.com:127.0.0.1
      - wjl.api.jd.kalading.com:127.0.0.1
      - wjl.api.notice.kalading.com:127.0.0.1
      - wjl.api.notify.kalading.com:127.0.0.1
      - wjl.api.scm.kalading.com:127.0.0.1
      - wjl.api.user.kalading.com:127.0.0.1
      - wjl.backend.kalading.com:127.0.0.1
      - wjl.m.kalading.com:127.0.0.1
      - wjl1.api.jd.kalading.com:127.0.0.1
      - wjl1.jd.kalading.com:127.0.0.1
      - wjl.jd.kalading.com:127.0.0.1
      - wjl.scm.kalading.com:127.0.0.1
      - ljx.api.backend.kalading.com:127.0.0.1
      - ljx.api.car.kalading.com:127.0.0.1
      - ljx.api.crm.kalading.com:127.0.0.1
      - ljx.api.jd.kalading.com:127.0.0.1
      - ljx.api.notice.kalading.com:127.0.0.1
      - ljx.api.notify.kalading.com:127.0.0.1
      - ljx.api.scm.kalading.com:127.0.0.1
      - ljx.api.user.kalading.com:127.0.0.1
      - ljx.backend.kalading.com:127.0.0.1
      - ljx.m.kalading.com:127.0.0.1
      - ljx1.api.jd.kalading.com:127.0.0.1
      - ljx1.jd.kalading.com:127.0.0.1
      - ljx.jd.kalading.com:127.0.0.1
      - ljx.scm.kalading.com:127.0.0.1
      #replace_extra_host#

    networks:
      - backend
  ### gocron web & node
  gocron:
    build:
      context: ./gocron
    volumes:
      - /kalading/webroot:/kalading/webroot
      #- /kalading/webroot/nginx:/etc/nginx/conf.d/
    ports:
      - "5921:5921"
      - "5920:5920"
    networks:
      - backend

